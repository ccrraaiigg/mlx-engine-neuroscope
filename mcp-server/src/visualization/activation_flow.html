<!-- 
  AUTO-GENERATED FILE - DO NOT EDIT
  This file was automatically generated by the MCP server.
  Generated at: 2025-08-20T00:14:11.952Z
  Any manual changes will be overwritten.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activation Flow Visualization</title>
    <style>
        body { margin: 0; padding: 20px; background: #1a1a1a; color: white; font-family: Arial, sans-serif; }
        h1 { color: #4285f4; }
        #graph-container { width: 80%; height: 480px; border: 1px solid #333; background: #2a2a2a; margin: 20px auto; position: relative; }
        .metadata { background: #444; padding: 10px; margin: 10px 0; border-radius: 5px; font-size: 14px; }
        .node-info { background: #333; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .physics-controls { position: absolute; top: 10px; right: 10px; z-index: 1000; }
        .physics-btn { 
            background: #4285f4; 
            color: white; 
            border: none; 
            padding: 8px 16px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .physics-btn:hover { background: #5294ff; }
        .physics-btn:active { background: #3275e5; }
        
        .css-label {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 14px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,1);
            z-index: 1000;
            pointer-events: none;
            white-space: nowrap;
            font-family: Arial, sans-serif;
            user-select: none;
        }
        
        #labels-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <h1>Activation Flow Visualization</h1>
    <div class="metadata">
        <h3>📊 Activation Flow Data Summary</h3>
        <p><strong>Model:</strong> GPT-OSS-20B (20 layers, 768 hidden dimensions)</p>
        <p><strong>Nodes:</strong> 6 | <strong>Links:</strong> 5</p>
        <p><strong>Input:</strong> "What is the relationship between consciousness and free will in the context of deterministic physical processes?" | <strong>Output:</strong> "Neural activation patterns"</p>
        <p><strong>Total Activations Captured:</strong> 11520 tensors across multiple layers</p>
    </div>
    <div class="physics-controls">
        <button id="physics-btn" class="physics-btn">Play Physics</button>
    </div>
    <div id="graph-container">
    </div>
    
    <script type="module">
        import { ForceGraph3DRenderer } from './renderer/force_graph_3d_renderer.js';
        console.log('ForceGraph3DRenderer imported successfully');
        
        const rawActivationData = {"nodes":[{"id":"layer_0_attention","label":"L0 Attention","type":"attention","layer":0,"color":"#ff6b6b","value":8,"metadata":{"component":"attention","layer":0,"activation_count":768}},{"id":"layer_0_mlp","label":"L0 MLP","type":"mlp","layer":0,"color":"#4ecdc4","value":10,"metadata":{"component":"mlp","layer":0,"activation_count":3072}},{"id":"layer_1_attention","label":"L1 Attention","type":"attention","layer":1,"color":"#ff6b6b","value":8,"metadata":{"component":"attention","layer":1,"activation_count":768}},{"id":"layer_1_mlp","label":"L1 MLP","type":"mlp","layer":1,"color":"#4ecdc4","value":10,"metadata":{"component":"mlp","layer":1,"activation_count":3072}},{"id":"layer_2_attention","label":"L2 Attention","type":"attention","layer":2,"color":"#ff6b6b","value":8,"metadata":{"component":"attention","layer":2,"activation_count":768}},{"id":"layer_2_mlp","label":"L2 MLP","type":"mlp","layer":2,"color":"#4ecdc4","value":10,"metadata":{"component":"mlp","layer":2,"activation_count":3072}}],"links":[{"id":"layer_0_attention_to_layer_0_mlp","source":"layer_0_attention","target":"layer_0_mlp","type":"within_layer","color":"#ffffff","weight":2,"metadata":{"connection_type":"attention_to_mlp","layer":0}},{"id":"layer_1_attention_to_layer_1_mlp","source":"layer_1_attention","target":"layer_1_mlp","type":"within_layer","color":"#ffffff","weight":2,"metadata":{"connection_type":"attention_to_mlp","layer":1}},{"id":"layer_0_mlp_to_layer_1_attention","source":"layer_0_mlp","target":"layer_1_attention","type":"cross_layer","color":"#6bcf7f","weight":1.5,"metadata":{"connection_type":"mlp_to_attention","from_layer":0,"to_layer":1}},{"id":"layer_2_attention_to_layer_2_mlp","source":"layer_2_attention","target":"layer_2_mlp","type":"within_layer","color":"#ffffff","weight":2,"metadata":{"connection_type":"attention_to_mlp","layer":2}},{"id":"layer_1_mlp_to_layer_2_attention","source":"layer_1_mlp","target":"layer_2_attention","type":"cross_layer","color":"#6bcf7f","weight":1.5,"metadata":{"connection_type":"mlp_to_attention","from_layer":1,"to_layer":2}}]};
        
        console.log('🔥 Initializing 3D Force Graph visualization for activation flow');
        console.log('Raw activation data keys:', Object.keys(rawActivationData));
        console.log('Data conversion status:', rawActivationData.nodes ? 'Already converted' : 'Raw activation data');
        console.log('Expected nodes:', rawActivationData.nodes?.length || 'TBD');
        console.log('Expected links:', rawActivationData.links?.length || 'TBD');
        
        async function initializeForceGraph() {
            try {
                let graphData;
                
                if (rawActivationData.nodes && rawActivationData.links) {
                    console.log('✅ Using converted graph data');
                    graphData = rawActivationData;
                } else {
                    throw new Error('❌ No valid graph data found - data conversion failed. Check server-side conversion logic.');
                }
                
                console.log('Graph data for 3D Force Graph:', graphData);
                
                const container = document.getElementById('graph-container');
                const renderer = new ForceGraph3DRenderer(container, {
                    backgroundColor: '#1a1a1a',
                    nodeColor: '#58a6ff',
                    linkColor: '#ffffff',
                    nodeOpacity: 0.8,
                    linkOpacity: 0.8,
                    nodeRelSize: 4,
                    linkWidth: 3,
                    showNodeLabels: true,
                    showLinkLabels: false,
                    controlType: 'trackball',
                    enableNodeDrag: true,
                    enableNavigationControls: true,
                    enablePointerInteraction: true
                });
                
                console.log('3D Force Graph renderer initialized');
                
                renderer.onNodeHover((node) => {
                    if (node) {
                        console.log('Hovering node:', node.label || node.id);
                    }
                });
                
                renderer.onNodeClick((node) => {
                    if (node) {
                        console.log('Clicked node:', node.label || node.id);
                    }
                });
                
                await renderer.loadGraph(graphData);
                console.log('✅ Graph loaded successfully');
                
                console.log('Node labels enabled via renderer configuration');
                
                let physicsPlaying = true;
                
                const setupPhysicsControls = () => {
                    const physicsBtn = document.getElementById('physics-btn');
                    
                    if (physicsBtn) {
                        physicsBtn.textContent = 'Pause Physics';
                        console.log('Physics initialized as running');
                        
                        physicsBtn.addEventListener('click', () => {
                            if (physicsPlaying) {
                                if (renderer.graph && typeof renderer.graph.d3Force === 'function') {
                                    renderer.graph.d3Force('charge', null)
                                                  .d3Force('link', null)
                                                  .d3Force('center', null);
                                    
                                    const graphData = renderer.graph.graphData();
                                    if (graphData && graphData.nodes) {
                                        graphData.nodes.forEach(node => {
                                            node.fx = node.x;
                                            node.fy = node.y;
                                            node.fz = node.z;
                                        });
                                    }
                                    
                                    if (typeof renderer.graph.enableNodeDrag === 'function') {
                                        renderer.graph.enableNodeDrag(true);
                                        console.log('Node dragging enabled with forces disabled');
                                    }
                                    
                                    physicsBtn.textContent = 'Play Physics';
                                    physicsPlaying = false;
                                    console.log('Physics forces disabled, nodes fixed in position');
                                } else {
                                    console.error('d3Force method not available on graph instance');
                                }
                            } else {
                                if (renderer.graph && typeof renderer.graph.d3Force === 'function') {
                                    enablePhysicsForces();
                                } else {
                                    console.error('d3Force method not available on graph instance');
                                }
                            }
                            
                            function enablePhysicsForces() {
                                const graphData = renderer.graph.graphData();
                                const nodes = graphData?.nodes || [];
                                
                                nodes.forEach(node => {
                                    delete node.fx;
                                    delete node.fy;
                                    delete node.fz;
                                });
                                
                                renderer.graph.d3Force('charge', d3.forceManyBody().strength(-300))
                                              .d3Force('link', d3.forceLink().id(d => d.id).distance(100))
                                              .d3Force('center', d3.forceCenter());
                                
                                physicsBtn.textContent = 'Pause Physics';
                                physicsPlaying = true;
                                console.log('Physics forces re-enabled');
                            }
                        });
                    }
                };
                
                setupPhysicsControls();
                
            } catch (error) {
                console.error('❌ Error initializing 3D Force Graph:', error);
                document.getElementById('graph-container').innerHTML = 
                    '<div style="color: red; padding: 20px;">Error loading visualization: ' + error.message + '</div>';
            }
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeForceGraph);
        } else {
            initializeForceGraph();
        }
    </script>
</body>
</html>